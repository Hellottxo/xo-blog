<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Eventloop äº‹ä»¶å¾ªç¯ | XO'S BLOG</title>
    <meta name="description" content="A VitePress site">
    <link rel="stylesheet" href="/xo-blog/assets/style.70c2fb3e.css">
    <link rel="modulepreload" href="/xo-blog/assets/app.9bd94a15.js">
    <link rel="modulepreload" href="/xo-blog/assets/browser_eventloop.md.403411e5.lean.js">
    
    <meta name="twitter:title" content="Eventloop äº‹ä»¶å¾ªç¯ | XO&#39;S BLOG">
  <meta property="og:title" content="Eventloop äº‹ä»¶å¾ªç¯ | XO&#39;S BLOG">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/xo-blog/" aria-label="XO&#39;S BLOG, back to home" data-v-675d8756 data-v-cc01ef16><!----> XO&#39;S BLOG</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/Hellottxo" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Github <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="http://xo.silenttt.top/xo-ui" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>XO-UI <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="http://xo.silenttt.top/leetcode-records" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>leetcode-records <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/Hellottxo" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Github <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="http://xo.silenttt.top/xo-ui" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>XO-UI <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="http://xo.silenttt.top/leetcode-records" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>leetcode-records <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><p class="sidebar-link-item">js</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/xo-blog/js/this">thisçš„æŒ‡å‘</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/xo-blog/js/variable">å˜é‡å’Œç±»å‹</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/xo-blog/js/prototype">åŸå‹å’ŒåŸå‹é“¾</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/xo-blog/js/inheritance">ç»§æ‰¿</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/xo-blog/js/handleWrite">æ‰‹å†™ç³»åˆ—</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/xo-blog/js/promise">æ‰‹å†™Promise</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/xo-blog/js/implicitConversion">éšå¼è½¬æ¢</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/xo-blog/js/event">äº‹ä»¶å§”æ‰˜</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/xo-blog/js/numInJs">å°æ•°ç²¾åº¦ä¸¢å¤±çš„åŸå› </a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/xo-blog/js/lottie-web">lottie-webå®è·µä¸åˆ†æ</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/xo-blog/Vue/frame">Vue/React</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/xo-blog/Vue/lifecycle">ä»æºç çœ‹ç”Ÿå‘½å‘¨æœŸLifeCycle</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/xo-blog/Vue/computed">ä»æºç çœ‹watchå’Œcomputed</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">css</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/xo-blog/css/transform">ç”¨csså®ç°è§†å·®æ•ˆæœ</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/xo-blog/css/loading-animation">loadingåŠ¨ç”»</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/xo-blog/css/css-base">cssåŸºç¡€</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/xo-blog/css/response">å“åº”å¼å¸ƒå±€</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/xo-blog/html/h5">html5</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">æµè§ˆå™¨</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item active" href="/xo-blog/browser/eventloop">äº‹ä»¶å¾ªç¯</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#ä»€ä¹ˆæ˜¯-eventloop">ä»€ä¹ˆæ˜¯ Eventloop</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡">å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/xo-blog/browser/cache">æµè§ˆå™¨ç¼“å­˜ç­–ç•¥</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/xo-blog/browser/reflow">å›æµå’Œé‡ç»˜</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/xo-blog/computer/http">http</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">ç®—æ³•</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/xo-blog/algorithm/sort">æ’åºç®—æ³•</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/xo-blog/algorithm/subject">ç®—æ³•é¢˜è®°å½•</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="eventloop-äº‹ä»¶å¾ªç¯" tabindex="-1">Eventloop äº‹ä»¶å¾ªç¯ <a class="header-anchor" href="#eventloop-äº‹ä»¶å¾ªç¯" aria-hidden="true">#</a></h1><p>ä»éœ€æ±‚å¼€å§‹ï¼Œä¸ºä»€ä¹ˆè¦äº†è§£ Eventloopï¼Ÿå…ˆä¸¾ä¸ªç®€å•çš„æ —å­ ğŸŒ°ï¼š</p><div class="language-javascript"><pre><code><span class="token keyword">const</span> <span class="token function-variable function">validate</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> timeStamp <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> timeStamp<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ä¸Šè¿°çš„ä»£ç çš„è¿è¡Œç»“æœæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ˜¯<code>500</code>å—ï¼Ÿ</p><p>äº‹å®ä¸Šï¼Œå½“æˆ‘ä»¬å°è¯•å¤šæ¬¡è¿è¡Œ validate å‡½æ•°ï¼Œä¼šå‘ç°ï¼Œ<code>setTimeout</code>çš„å›è°ƒå‡½æ•°æ‰“å°å‡ºæ¥çš„ç»“æœå¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è±¡ä¸­çš„ 500ï¼Œç”šè‡³ä¸æ˜¯ä¸€ä¸ªå›ºå®šçš„æ•°å€¼ã€‚</p><div class="language-"><pre><code>validate(); // 501
validate(); // 503
validate(); // 502
</code></pre></div><p>ä¸ºä»€ä¹ˆå®šæ—¶å™¨ä¸å¦‚æˆ‘ä»¬æƒ³è±¡ä¸­çš„æ–¹å¼è¿ä½œå‘¢ï¼Ÿ</p><p>è®©æˆ‘ä»¬å¸¦ç€ç–‘é—®ï¼Œæ¥å­¦ä¹  Eventloop å§ã€‚</p><p>é€šè¿‡å­¦ä¹  Eventloopï¼Œæ·±å…¥äº†è§£ Js åœ¨æµè§ˆå™¨ä¸­çš„è¿è¡Œæœºåˆ¶ï¼Œä»¥æ–¹ä¾¿æˆ‘ä»¬åœ¨å·¥ä½œå’Œå­¦ä¹ ä¸­æ›´åŠ è½»æ¾çš„è§£å†³å„ç§é—®é¢˜ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-eventloop" tabindex="-1">ä»€ä¹ˆæ˜¯ Eventloop <a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-eventloop" aria-hidden="true">#</a></h2><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼š<strong>JS æ˜¯ä¸€é—¨å•çº¿ç¨‹è¯­è¨€</strong>ã€‚é‚£ä¹ˆåƒ<code>setTimeout</code>è¿™æ ·çš„å¼‚æ­¥ä»£ç ç©¶ç«Ÿæ˜¯å¦‚ä½•è¿è¡Œçš„å‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä»<a href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" target="_blank" rel="noopener noreferrer">HTML5 standard</a>ä¸­äº†è§£åˆ°ï¼šä¸€ä¸ª eventloop æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼ˆTask queuesï¼‰ï¼Œä¸€ä¸ª Task queue åŒ…å«ä¸€ç»„ taskã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<a href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" target="_blank" rel="noopener noreferrer">HTML5 standard</a>ç‰¹æ„æé†’äº†æˆ‘ä»¬ï¼š</p><blockquote><p><a href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" target="_blank" rel="noopener noreferrer">Task queues</a> <em>are</em> <a href="https://infra.spec.whatwg.org/#ordered-set" target="_blank" rel="noopener noreferrer">sets</a><em>, not</em> <a href="https://infra.spec.whatwg.org/#queue" target="_blank" rel="noopener noreferrer">queues</a><em>, because</em> <a href="https://html.spec.whatwg.org/multipage/webappapis.html#step1" target="_blank" rel="noopener noreferrer">step one of the event loop processing model</a> <em>grabs the first</em> <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-runnable" target="_blank" rel="noopener noreferrer"><em>runnable</em></a> <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" target="_blank" rel="noopener noreferrer">task</a> <em>from the chosen queue, instead of</em> <a href="https://infra.spec.whatwg.org/#queue-dequeue" target="_blank" rel="noopener noreferrer">dequeuing</a> <em>the first task.</em></p></blockquote><p>æ¥çœ‹ä¸€å¼ ç»å…¸çš„ eventloop è¿è¡Œå›¾ã€‚</p><p><img src="/xo-blog/assets/eventloop.7238f039.jpeg" alt=""></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œtask æ‰§è¡Œæ—¶ä¼šä¼šå°†ä»£ç  push è¿›è°ƒç”¨æ ˆï¼ˆCall Stackï¼‰ï¼Œæ‰§è¡Œå®Œæ¯•åï¼Œä»¥åè¿›å…ˆå‡ºçš„åŸåˆ™ä»è°ƒç”¨æ ˆä¸­ç§»é™¤ã€‚è°ƒç”¨æ ˆä¸­é‡åˆ°å¼‚æ­¥ API æ—¶ï¼Œæ»¡è¶³æ¡ä»¶åå°†å¼‚æ­¥ API çš„å›è°ƒå‡½æ•°æ”¾å…¥äº‹ä»¶é˜Ÿåˆ—ï¼ˆEvent Queueï¼‰ä¸­ï¼Œ ç­‰å¾…å½“å‰è°ƒç”¨æ ˆæ¸…ç©ºåï¼Œä»¥å…ˆè¿›å…ˆå‡ºçš„åŸåˆ™ï¼Œæ‰§è¡Œäº‹ä»¶é˜Ÿåˆ—ä¸­çš„å›è°ƒå‡½æ•°ï¼Œå¦‚æ­¤å¾ªç¯å¾€å¤ï¼Œå°±æ˜¯<strong>Eventloop</strong>ã€‚</p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å›åˆ°ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œ<strong>ä¸ºä»€ä¹ˆ setTimeout å®šæ—¶å™¨ä¸å¦‚æˆ‘ä»¬æƒ³è±¡ä¸­å‡†ç¡®å‘¢ï¼Ÿ</strong></p><p>ç­”æ¡ˆå·²ç»å‘¼ä¹‹æ¬²å‡ºäº†ï¼šå®šæ—¶å™¨è®¾ç½®çš„æ—¶é—´è¿‡åï¼Œ<code>setTimeout</code>çš„å›è°ƒå‡½æ•°æ”¾å…¥äº‹ä»¶é˜Ÿåˆ—åï¼Œç­‰å¾…è°ƒç”¨æ ˆæ‰§è¡Œçš„è¿™æ®µæ—¶é—´ï¼Œé€ æˆäº†å®šæ—¶å™¨æ‰§è¡Œçš„è¯¯å·®ã€‚</p><p>è®©æˆ‘ä»¬æ›´åŠ æ·±å…¥ä¸€ç‚¹ï¼Œå½“ Promise é‡ä¸Š</p><p>å€Ÿç”¨ä¸€ä¸‹ Jake Archibald çš„ä¾‹å­ã€‚</p><div class="language-javascript"><pre><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;script start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;setTimeout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;promise1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;promise2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;script end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ä¸Šé¢è¿™æ®µä»£ç çš„è¾“å‡ºç»“æœä¼šæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p><div class="language-javascript"><pre><code>script start
script end
promise1
promise2
setTimeout
</code></pre></div><p>å’¦ï¼Œå’Œæƒ³è±¡ä¸­çš„ç»“æœä¸å¤ªä¸€æ ·å¯¹ä¸å¯¹ï¼Ÿ</p><p>æŒ‰ç…§å‰æ–‡çš„æè¿°ï¼Œæˆ‘ä»¬ç†æƒ³çš„ç»“æœåº”å½“æ˜¯:</p><div class="language-js"><pre><code>script start
script end
setTimeout
promise1
promise2
</code></pre></div><p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><h2 id="å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡" tabindex="-1">å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ <a class="header-anchor" href="#å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡" aria-hidden="true">#</a></h2><p>ä¸æ€¥ï¼Œè®©æˆ‘ä»¬å…ˆçœ‹çœ‹<a href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" target="_blank" rel="noopener noreferrer">HTML5 standard</a>ä¸­å¯¹<strong>eventloop</strong>çš„è¿™æ ·ä¸€æ®µæè¿°ï¼š</p><blockquote><p>Each <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" target="_blank" rel="noopener noreferrer">event loop</a> has a currently running task, which is either a <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" target="_blank" rel="noopener noreferrer">task</a> or null. Initially, this is null. It is used to handle reentrancy.</p><p>Each <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" target="_blank" rel="noopener noreferrer">event loop</a> has a microtask queue, which is a <a href="https://infra.spec.whatwg.org/#queue" target="_blank" rel="noopener noreferrer">queue</a> of <a href="https://html.spec.whatwg.org/multipage/webappapis.html#microtask" target="_blank" rel="noopener noreferrer">microtasks</a>, initially empty. A microtask is a colloquial way of referring to a <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" target="_blank" rel="noopener noreferrer">task</a> that was created via the <a href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-microtask" target="_blank" rel="noopener noreferrer">queue a microtask</a> algorithm.</p><p>Each <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" target="_blank" rel="noopener noreferrer">event loop</a> has a performing a microtask checkpoint boolean, which is initially false. It is used to prevent reentrant invocation of the <a href="https://html.spec.whatwg.org/multipage/webappapis.html#perform-a-microtask-checkpoint" target="_blank" rel="noopener noreferrer">perform a microtask checkpoint</a> algorithm.</p></blockquote><p>é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šå°†å¼‚æ­¥ API åˆ†ä¸º<strong>å®ä»»åŠ¡ï¼ˆmacrotaskï¼‰<strong>å’Œ</strong>å¾®ä»»åŠ¡ï¼ˆmicrotaskï¼‰</strong>ï¼Œä¹Ÿå°±æ˜¯ä¸Šè¿°æ ‡å‡†ä¸­çš„ task å’Œ microtaskã€‚<strong>å¾®ä»»åŠ¡ä¼šå…ˆäºå®ä»»åŠ¡æ‰§è¡Œï¼Œå®ä»»åŠ¡ä¼šè§¦å‘ä¸€æ¬¡å®Œæ•´çš„äº‹ä»¶å¾ªç¯ï¼Œè€Œå¾®ä»»åŠ¡ä¸ä¼šã€‚</strong></p><p><strong>å¸¸è§çš„æµè§ˆå™¨å¾®ä»»åŠ¡/å®ä»»åŠ¡</strong></p><blockquote><p><strong>å®ä»»åŠ¡ï¼ˆmacrotaskï¼‰</strong>ï¼šsetTimeoutã€setIntervalã€I/Oã€UI äº¤äº’äº‹ä»¶ç­‰ã€‚</p><p><strong>å¾®ä»»åŠ¡ï¼ˆmicrotaskï¼‰</strong>ï¼šPromise.thenã€ MutationObserver ç­‰ã€‚</p></blockquote><p>åŸºäºå®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ï¼Œè®©æˆ‘ä»¬å†å®Œå–„ä¸€ä¸‹å¯¹äº<strong>Eventloop</strong>çš„æè¿°ï¼š</p><ol><li>task æ‰§è¡Œæ—¶ä¼šä¼šå°†ä»£ç  push è¿›è°ƒç”¨æ ˆï¼ˆCall Stackï¼‰ï¼Œæ‰§è¡Œå®Œæ¯•åï¼Œä»¥åè¿›å…ˆå‡ºçš„åŸåˆ™ä»è°ƒç”¨æ ˆä¸­ç§»é™¤ï¼›</li><li>è°ƒç”¨æ ˆä¸­é‡åˆ°å¼‚æ­¥ API æ—¶ï¼Œæ»¡è¶³æ¡ä»¶åï¼Œå¾®ä»»åŠ¡åŠå®ä»»åŠ¡çš„å›è°ƒå‡½æ•°åˆ†åˆ«è¿›å…¥ç›¸åº”çš„äº‹ä»¶é˜Ÿåˆ—ï¼›</li><li>ç­‰å¾…å½“å‰è°ƒç”¨æ ˆæ¸…ç©ºåï¼Œä¾æ¬¡æ‰§è¡Œå¾®ä»»åŠ¡äº‹ä»¶é˜Ÿåˆ—ä¸­çš„å›è°ƒå‡½æ•°ï¼›</li><li>å½“å¾®ä»»åŠ¡äº‹ä»¶é˜Ÿåˆ—åŠå½“å‰è°ƒç”¨æ ˆæ¸…ç©ºåï¼Œå¼€å§‹æ‰§è¡Œå®ä»»åŠ¡äº‹ä»¶é˜Ÿåˆ—ä¸­çš„å›è°ƒå‡½æ•°ã€‚å¦‚æ­¤å¾ªç¯å¾€å¤ï¼Œå°±æ˜¯<strong>Eventloop</strong>ã€‚</li></ol><p>è¿™æ—¶ï¼Œå›åˆ°ä¸Šæ–‡ä¸­<code>promise</code>å’Œ<code>setTimeout</code>çš„ä¾‹å­ï¼Œæˆ‘ä»¬æ¥é€è¡Œè§£æä¸€ä¸‹ï¼š</p><ol><li>å½“å‰ task æ‰§è¡Œï¼Œè¾“å‡º<code>script start</code></li><li>setTimeout çš„ callback è¢«æ·»åŠ è¿› macrotask é˜Ÿåˆ—ä¸­</li><li>å®ä¾‹åŒ–<code>Promise</code>ï¼Œ<code>Promise.then</code>çš„ callback è¢«ä¾æ¬¡æ·»åŠ è¿› microtask é˜Ÿåˆ—ä¸­</li><li>è¾“å‡º<code>script end</code></li><li>å½“å‰ task æ‰§è¡Œå®Œæ¯•ï¼Œcall stack ä¸ºç©ºï¼Œä¾æ¬¡æ‰§è¡Œ microtask é˜Ÿåˆ—ä¸­çš„ callbackï¼Œä¾æ¬¡è¾“å‡º 1ï¼Œ2</li><li>æ‰§è¡Œä¸‹ä¸€ä¸ª taskï¼Œè¾“å‡º<code>setTimeout</code></li></ol></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-07c132fc><div class="edit" data-v-07c132fc><div class="edit-link" data-v-07c132fc data-v-1ed99556><!----></div></div><div class="updated" data-v-07c132fc><p class="last-updated" data-v-07c132fc data-v-abce3432><span class="prefix" data-v-abce3432>Last Updated:</span><span class="datetime" data-v-abce3432></span></p></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/xo-blog/html/h5" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>html5</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/xo-blog/browser/cache" data-v-38ede35f><span class="text" data-v-38ede35f>æµè§ˆå™¨ç¼“å­˜ç­–ç•¥</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"vue_computed.md\":\"22806c3c\",\"vue_desginpattern.md\":\"11913128\",\"vue_frame.md\":\"cd8dd27b\",\"vue_lifecycle.md\":\"8ff16022\",\"algorithm_sort.md\":\"02daefa5\",\"algorithm_subject.md\":\"d5a54fdc\",\"browser_cache.md\":\"9fe7643d\",\"browser_eventloop.md\":\"403411e5\",\"browser_reflow.md\":\"fcb2f211\",\"computer_hownetworkconnect.md\":\"a0c3b703\",\"computer_http.md\":\"74ed737b\",\"computer_tcp.md\":\"53b3a8a6\",\"computer_unicode.md\":\"a46a19d4\",\"css_css-base.md\":\"80e87190\",\"css_loading-animation.md\":\"8523a597\",\"css_response.md\":\"bea393a9\",\"css_transform.md\":\"4f1d0a3c\",\"html_h5.md\":\"039f9e4d\",\"index.md\":\"7c195211\",\"js_proxy.md\":\"4909f2ad\",\"js_event.md\":\"7d841a6e\",\"js_handlewrite.md\":\"e0821e58\",\"js_implicitconversion.md\":\"f292bb04\",\"js_inheritance.md\":\"72f93f6f\",\"js_lottie-web.md\":\"185dd081\",\"js_numinjs.md\":\"cd7c875a\",\"js_promise.md\":\"a5ac142c\",\"js_prototype.md\":\"8e41f296\",\"js_this.md\":\"a415d556\",\"js_variable.md\":\"53a8c6cd\",\"js_webpack.md\":\"3dba148b\"}")</script>
    <script type="module" async src="/xo-blog/assets/app.9bd94a15.js"></script>
    
  </body>
</html>