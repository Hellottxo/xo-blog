<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>娣卞叆瀛楃闆嗕笌缂栫爜-深入字符集与编码 | XO&#39;S BLOG</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/xo-blog/logo.svg">
    <meta name="description" content="">
    <link rel="preload" href="/xo-blog/assets/css/0.styles.c46e3eb6.css" as="style"><link rel="preload" href="/xo-blog/assets/js/app.53de2eda.js" as="script"><link rel="preload" href="/xo-blog/assets/js/23.df71a9a8.js" as="script"><link rel="preload" href="/xo-blog/assets/js/22.21716c97.js" as="script"><link rel="preload" href="/xo-blog/assets/js/32.b0d4372d.js" as="script"><link rel="prefetch" href="/xo-blog/assets/js/1.c87d790e.js"><link rel="prefetch" href="/xo-blog/assets/js/10.55f71a86.js"><link rel="prefetch" href="/xo-blog/assets/js/11.6de19542.js"><link rel="prefetch" href="/xo-blog/assets/js/12.22195367.js"><link rel="prefetch" href="/xo-blog/assets/js/13.e8d61a18.js"><link rel="prefetch" href="/xo-blog/assets/js/14.07c612f4.js"><link rel="prefetch" href="/xo-blog/assets/js/15.4b82d101.js"><link rel="prefetch" href="/xo-blog/assets/js/16.cd3036c7.js"><link rel="prefetch" href="/xo-blog/assets/js/17.ac5803f1.js"><link rel="prefetch" href="/xo-blog/assets/js/18.96de5821.js"><link rel="prefetch" href="/xo-blog/assets/js/19.f5feeaba.js"><link rel="prefetch" href="/xo-blog/assets/js/2.16fc97dd.js"><link rel="prefetch" href="/xo-blog/assets/js/20.9fee0aaf.js"><link rel="prefetch" href="/xo-blog/assets/js/24.ae2356ef.js"><link rel="prefetch" href="/xo-blog/assets/js/25.4ce501e5.js"><link rel="prefetch" href="/xo-blog/assets/js/26.0fe5b206.js"><link rel="prefetch" href="/xo-blog/assets/js/27.9662e022.js"><link rel="prefetch" href="/xo-blog/assets/js/28.d6eeb3f1.js"><link rel="prefetch" href="/xo-blog/assets/js/29.6143d17f.js"><link rel="prefetch" href="/xo-blog/assets/js/3.dd555f77.js"><link rel="prefetch" href="/xo-blog/assets/js/30.b08d0679.js"><link rel="prefetch" href="/xo-blog/assets/js/31.a32281c5.js"><link rel="prefetch" href="/xo-blog/assets/js/33.a71bb1a1.js"><link rel="prefetch" href="/xo-blog/assets/js/34.e0cf491e.js"><link rel="prefetch" href="/xo-blog/assets/js/35.9091ca7c.js"><link rel="prefetch" href="/xo-blog/assets/js/36.a72797f1.js"><link rel="prefetch" href="/xo-blog/assets/js/37.4a795e7b.js"><link rel="prefetch" href="/xo-blog/assets/js/38.b9cbe37f.js"><link rel="prefetch" href="/xo-blog/assets/js/39.f8c59d14.js"><link rel="prefetch" href="/xo-blog/assets/js/4.56bf3949.js"><link rel="prefetch" href="/xo-blog/assets/js/40.d9ea3ae3.js"><link rel="prefetch" href="/xo-blog/assets/js/41.75c40726.js"><link rel="prefetch" href="/xo-blog/assets/js/42.5e2c7f83.js"><link rel="prefetch" href="/xo-blog/assets/js/43.5b644fd7.js"><link rel="prefetch" href="/xo-blog/assets/js/44.a5ea30ce.js"><link rel="prefetch" href="/xo-blog/assets/js/45.00eadec9.js"><link rel="prefetch" href="/xo-blog/assets/js/46.615f4849.js"><link rel="prefetch" href="/xo-blog/assets/js/47.561a8bb7.js"><link rel="prefetch" href="/xo-blog/assets/js/48.fd566846.js"><link rel="prefetch" href="/xo-blog/assets/js/49.65167833.js"><link rel="prefetch" href="/xo-blog/assets/js/5.df069e2f.js"><link rel="prefetch" href="/xo-blog/assets/js/50.0082835f.js"><link rel="prefetch" href="/xo-blog/assets/js/51.ad853adb.js"><link rel="prefetch" href="/xo-blog/assets/js/52.8979dab7.js"><link rel="prefetch" href="/xo-blog/assets/js/53.89b6f46b.js"><link rel="prefetch" href="/xo-blog/assets/js/54.42c2b2a3.js"><link rel="prefetch" href="/xo-blog/assets/js/55.3d34c247.js"><link rel="prefetch" href="/xo-blog/assets/js/56.4573d952.js"><link rel="prefetch" href="/xo-blog/assets/js/57.9f53aa66.js"><link rel="prefetch" href="/xo-blog/assets/js/58.995de252.js"><link rel="prefetch" href="/xo-blog/assets/js/59.0f42cb8b.js"><link rel="prefetch" href="/xo-blog/assets/js/6.79264116.js"><link rel="prefetch" href="/xo-blog/assets/js/7.37fb6cae.js"><link rel="prefetch" href="/xo-blog/assets/js/8.310d1684.js"><link rel="prefetch" href="/xo-blog/assets/js/9.6ff7fad8.js">
    <link rel="stylesheet" href="/xo-blog/assets/css/0.styles.c46e3eb6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><!----> <header class="navbar" style="z-index:10;"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/xo-blog/" class="home-link router-link-active"><!----> <span class="site-name">XO'S BLOG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/Hellottxo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://xo.silenttt.top/xo-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XO-UI
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://xo.silenttt.top/leetcode-records" target="_blank" rel="noopener noreferrer" class="nav-link external">
  leetcode-records
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/Hellottxo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://xo.silenttt.top/xo-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XO-UI
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://xo.silenttt.top/leetcode-records" target="_blank" rel="noopener noreferrer" class="nav-link external">
  leetcode-records
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xo-blog/js/this.html" class="sidebar-link">this的指向</a></li><li><a href="/xo-blog/js/variable.html" class="sidebar-link">变量和类型</a></li><li><a href="/xo-blog/js/prototype.html" class="sidebar-link">原型和原型链</a></li><li><a href="/xo-blog/js/inheritance.html" class="sidebar-link">继承</a></li><li><a href="/xo-blog/js/handleWrite.html" class="sidebar-link">手写系列</a></li><li><a href="/xo-blog/js/promise.html" class="sidebar-link">手写Promise</a></li><li><a href="/xo-blog/js/implicitConversion.html" class="sidebar-link">隐式转换</a></li><li><a href="/xo-blog/js/event.html" class="sidebar-link">事件委托</a></li><li><a href="/xo-blog/js/numInJs.html" class="sidebar-link">小数精度丢失的原因</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>css</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xo-blog/css/transform.html" class="sidebar-link">用css实现视差效果</a></li><li><a href="/xo-blog/css/loading-animation.html" class="sidebar-link">loading动画</a></li><li><a href="/xo-blog/css/css.html" class="sidebar-link">css基础</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>html</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xo-blog/html/h5.html" class="sidebar-link">html5</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xo-blog/Vue/frame.html" class="sidebar-link">Vue/React</a></li><li><a href="/xo-blog/Vue/lifecycle.html" class="sidebar-link">从源码看生命周期LifeCycle</a></li><li><a href="/xo-blog/Vue/computed.html" class="sidebar-link">从源码看watch和computed</a></li><li><a href="/xo-blog/Vue/desginPattern.html" class="sidebar-link">Vue中的设计模式</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>浏览器</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xo-blog/browser/eventloop.html" class="sidebar-link">Eventloop 事件循环</a></li><li><a href="/xo-blog/browser/cache.html" class="sidebar-link">浏览器缓存策略</a></li><li><a href="/xo-blog/browser/reflow.html" class="sidebar-link">回流和重绘</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>计算机基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xo-blog/computer/http.html" class="sidebar-link">http</a></li><li><a href="/xo-blog/computer/howNetworkConnect.html" class="sidebar-link">精读《网络是怎样连接的》</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>算法</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xo-blog/algorithm/sort.html" class="sidebar-link">排序算法</a></li><li><a href="/xo-blog/algorithm/subject.html" class="sidebar-link">算法题记录</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="娣卞叆瀛楃闆嗕笌缂栫爜-深入字符集与编码"><a href="#娣卞叆瀛楃闆嗕笌缂栫爜-深入字符集与编码" class="header-anchor">#</a> 娣卞叆瀛楃闆嗕笌缂栫爜-深入字符集与编码</h1> <p>在浏览网页或文本时，有时会出现乱码的情况，大多数情况是因为编码不对，同一段文字，在不同编码下展示的结果不同：</p> <div class="language- extra-class"><pre class="language-text"><code>// UTF-8
深入字符集与编码

// GBK
娣卞叆瀛楃闆嗕笌缂栫爜
</code></pre></div><p>比如为了确保网页的正常展示，通常会在<code>html</code>会使用<code>meta</code>标签作出声明：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>然而，<code>charset=&quot;utf-8&quot;</code>并不如其字面意思是指定字符集（character set）为UTF-8。</p> <p>UTF-8是一种编码(encoding)方法，不是字符集。上述html标签用于声明使用UTF-8进行编码，而UTF-8是unicode字符集编码方法之一。</p> <h2 id="字符集和编码"><a href="#字符集和编码" class="header-anchor">#</a> 字符集和编码</h2> <p>我们都知道，计算机是由许多二极管组成，数据以二进制的形式储存在计算机底层。这个存储的过程中，就涉及到了数据的编码。</p> <p>先了解一下基础概念：</p> <p><strong>字符集（character set）</strong>，是各国家文字、标点符号、图形符号、数字的集合。字符集种类较多，每个字符集包含的字符个数不同，常见字符集有：ASCII字符集、GB2312字符集、BIG5字符集、 GB18030字符集、Unicode字符集等。字符集中包含了字符及其对应的代码值，这个代码值又称<strong>码点（code point）</strong>。</p> <p><strong>编码（encoding）</strong>，是计算机准确处理各种字符集文字，以便计算机能够识别和存储各种文字的方式。</p> <p>字符集的存在更像是一本字典，我们根据某个字符查询到了对应的码点，然后将其用相应的编码方式编码为二进制数据。</p> <p><img src="/xo-blog/assets/img/unicode-flow.b10f97ba.png" alt="unicode-flow"></p> <h2 id="字符集的发展史"><a href="#字符集的发展史" class="header-anchor">#</a> 字符集的发展史</h2> <h3 id="ascii"><a href="#ascii" class="header-anchor">#</a> ASCII</h3> <p>计算机应用的初期，为了用同一种编码方法在各种不同的计算机设备之间传递数据，1967年出台了美国信息交换标准代码（American Standard Code for Information Interchange,ASCII）。这套编码规则一共规定了128个字符的编码，包含了拉丁字母和阿拉伯数字、英式标点符号、控制字符（回车、方向）。</p> <p>由于出台的时间优势及其通用性，后期出现的字符集，基本都兼容了ASCII。</p> <h3 id="gbk"><a href="#gbk" class="header-anchor">#</a> GBK</h3> <p>虽然ASCII在英语字符标准化的道路上迈出了重要的一步，但它包含的字符编码有限，无法表达其他语言。</p> <p>简而言之，它支持使用英语说“hello”，但不支持使用中文说“您好”。</p> <p>为了解决这个问题，国内的规定了GB 类的汉字编码模式：ASCII 值小于 127 的字符的意义与原来 ASCII 集中的字符相同，但当两个 ASCII 值大于 127 的字符连在一起时，就表示一个简体中文的汉字，前面的一个字节（高字节）从 0xA1 拓展到 0xF7，后面一个字节（低字节）从 0xA1 到 0xFE。</p> <p>同时，为了在解码时操作的统一，GB 类编码表中还也加入了数学符号、罗马希腊的字母、日文的假名等，连在 ASCII 里本来就有的数字、标点、字母都统一重新表示为了两个字节长的编码，这就是我们常说的 &quot;全角&quot; 字符，而原来在 127 号以下的那些就叫 &quot;半角&quot; 字符了，这种编码规则就是后来的 GB2312字符集。</p> <p>中华文化博大精深，汉字总数高达8万之多，GB2312 字符集的码位无法满足需求，于是扩展出了新的GBK标准：只要第一个字节是大于 127 就固定表示这是一个汉字的开始，不管后面跟的是不是扩展字符集里的内容。GBK 包括了 GB2312 的所有内容，同时又增加了近 20000 个新的汉字（包括繁体字）和符号。</p> <h3 id="unicode"><a href="#unicode" class="header-anchor">#</a> Unicode</h3> <p>随着计算机的普及率不断上升，各国都出台了自己的编码标准，如西欧语言中的ISO 8859-1、俄罗斯的KOI-8、中国的GBK。对于任意给定的代码值，在不同的编码方案下有可能对应不同的字母，编码方案使用的编码长度也各不相同，这些不同的编码方案也为国际之间交流带来了一定的麻烦。1987年，Unicode编码方案应运而生，一统天下。它支持全球使用最广泛的语言、一些历史语言以及特殊符号，当然，它也兼容了ASCII字符集。</p> <h2 id="编码"><a href="#编码" class="header-anchor">#</a> 编码</h2> <p>许多情况下，字符集和编码被混为一谈，是因为大多数情况下，字符集与编码方式是一一对应的，比如ASCII，就只有一种编码方式，区分字符集和编码没有意义；相反的，unicode有多种编码方法，指定unicode，仅仅只是指定了字符的码点，我们的计算机还是不懂该用何种方式来进行编码成0和1。</p> <p>显然，字符集与编码是一一对应或者一对多的关系，只要指定了编码，则指定了所用字符集。</p> <p>![image-20211110165356788](/Users/xo/Library/Application Support/typora-user-images/image-20211110165356788.png)
<img src="/xo-blog/assets/img/charset.c629a1fc.png" alt="charset"></p> <p>那么为何unicode有UTF-8、UTF-16、UTF-32等多种编码方式呢？</p> <blockquote><p>UTF是&quot;Unicode/UCS Transformation Format&quot;的首字母缩写，即把Unicode字符转换为某种格式之意。</p></blockquote> <p>在区分一段二进制为一个字符还是多个字符的时候，最简单的办法是直接规定多少字节代表一个字符。</p> <p>ucs-2、utf-32就是使用这种方式。然而，正如中文有8万多个汉字，实际使用的却只有三千多个，如果每个字符都使用定长的方式编码，需要占用很大的空间，编码效率会下降。于是出现了不定长的编码方式，遵循一定的规则使用不同的字节长度存储不同码点的字符。</p> <h3 id="utf-16"><a href="#utf-16" class="header-anchor">#</a> <a href="https://datatracker.ietf.org/doc/html/rfc2781" target="_blank" rel="noopener noreferrer">UTF-16<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Utf-16是使用2或4个字节来进行编码的。</p> <p>Js是使用ucs-2进行编码的，而ucs-2是utf-8的前身。</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'烤🌰'</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
</code></pre></div><p>吖！烤🌰的长度为什么是3！让我们慢慢来看。</p> <p>ucs-2最初设计为使用2个字节，即16个bit，一共可以包含65536个字符，渐渐的人们发现6万多个字符不够用，于是对新增的字符使用4个字节，扩展成为了现在的utf-16。</p> <p><strong>编码规则：</strong></p> <table><thead><tr><th>Unicode 码点范围</th> <th>UTF-16 编码规则</th> <th>UTF-16编码</th></tr></thead> <tbody><tr><td>U+0000 - U+D7FU+E000 - U+FFFF</td> <td>使用双字节编码，其中U+D800～U+DFFF作为保留码点，不映射字符，辅助编码。</td> <td><code>xxxxxxxxxx xxxxxxxxxx</code></td></tr> <tr><td>U+10000 - U+10FFFF</td> <td>1 .码点减去65536后对应的二进制补足20位 <br>2. 将这20位二进制从中分割为上10位值和下10位值 <br>3. 将上值和0xD800相加得到高位，下值和0xDFFF相加得到低位</td> <td><code>110110xx xxxxxxxx 110111yy yyyyyyyy</code></td></tr></tbody></table> <p><strong>举个🌰:</strong></p> <ol><li><code>🌰</code>在unicode中的码点为U+1F330，0x1F330 - 65536 = 62456，转为二进制<code>1111001100110000</code></li> <li>补足20位后：<code>0000111100 1100110000</code>，上值：<code>0000111100</code>（十进制 60），下值：<code>1100110000</code>（十进制 186)</li> <li>分别与高低位相加，得到高位：60 + 0xD800 = 55356（十六进制d83c），底位：186 + 0xDC00 = 57136（十六进制df30）</li> <li>转为二进制，就得到了utf-8编码后的二进制数据啦：<code>11011000 00111100 11011111 00110000</code></li></ol> <p>而在<a href="https://262.ecma-international.org/5.1/#sec-8.4" target="_blank" rel="noopener noreferrer">es规范<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中指明，当对字符串进行操作时，会将一个utf-16码点为一个元素：</p> <blockquote><p>When a String contains actual textual data, each element is considered to be a single UTF-16 code unit. Whether or not this is the actual storage format of a String, the characters within a String are numbered by their initial code unit element position as though they were represented using UTF-16.</p></blockquote> <p>显然，🌰包含两个utf-16码点，所以有：<code>'烤🌰'.length === true</code></p> <p>我们在js中转义一下🌰的码点，是否能直接打印出来？</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'\u1f330'</span> <span class="token comment">// 'ἳ0'</span>
</code></pre></div><p>这是什么东东！前面说到，js实际上是使用的utf-16的前身ucs-2进行编码的，因此，超出U+0000 - U+FFFF码点范围的部分，转义失败了。当我们将高低位拼接起来进行转义：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'\ud83c\udf30'</span> <span class="token comment">// 🌰</span>
</code></pre></div><p>转义成功啦！</p> <p>🤔事实上，es6为了解决这个问题也提供了相应的兼容：</p> <p>可以使用<code>{}</code>将码点包围起来就可以准确无误的转义啦：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'\u{1f330}'</span> <span class="token comment">// 🌰</span>
</code></pre></div><p>而对于包含🌰这类ucs-2编码方案之后新增字符的字符串，可以通过扩展运算符、或者for...of对其进行操作：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span><span class="token operator">...</span>🌰<span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token comment">// 2</span>

<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">of</span> <span class="token string">'烤🌰'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 烤</span>
<span class="token comment">// 🌰</span>
</code></pre></div><h3 id="utf-8"><a href="#utf-8" class="header-anchor">#</a> <a href="https://datatracker.ietf.org/doc/html/rfc3629" target="_blank" rel="noopener noreferrer">UTF-8<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>utf-8是目前使用范围最广的编码模式。</p> <blockquote><p>UTF-8就是为了解决向后兼容ASCII码而设计，Unicode中前128个字符，使用与ASCII码相同的二进制值的单个<a href="https://zh.wikipedia.org/wiki/%E5%AD%97%E8%8A%82" target="_blank" rel="noopener noreferrer">字节<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>进行编码，而且字面与ASCII码的字面一一对应，这使得原来处理ASCII字符的<a href="https://zh.wikipedia.org/wiki/%E8%BB%9F%E9%AB%94" target="_blank" rel="noopener noreferrer">软件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>无须或只须做少部分修改，即可继续使用。因此，它逐渐成为<a href="https://zh.wikipedia.org/wiki/%E9%9B%BB%E5%AD%90%E9%83%B5%E4%BB%B6" target="_blank" rel="noopener noreferrer">电子邮件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://zh.wikipedia.org/wiki/%E7%B6%B2%E9%A0%81" target="_blank" rel="noopener noreferrer">网页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>及其他<a href="https://zh.wikipedia.org/wiki/%E5%84%B2%E5%AD%98%E8%A3%9D%E7%BD%AE" target="_blank" rel="noopener noreferrer">存储<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>或发送文字优先采用的编码方式。</p></blockquote> <p><strong>编码规则：</strong></p> <ol><li>单字节字符：字节的第一位为<code>0</code>，后面7位为字符的 Unicode 码</li> <li><code>n</code>字节字符（<code>n &gt; 1</code>）：第一个字节的前<code>n</code>位都设为<code>1</code>，第<code>n + 1</code>位设为<code>0</code>，后面字节的前两位设为<code>10</code>。剩下的二进制位，均为这个字符的 Unicode 码</li></ol> <p>显然，对于ASCII包含的字符，其编码模式与ASCII一致。</p> <blockquote><p>UTF-8使用一至六个<a href="https://zh.wikipedia.org/wiki/%E4%BD%8D%E5%85%83%E7%BB%84" target="_blank" rel="noopener noreferrer">字节<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>为每个字符编码（尽管如此，2003年11月UTF-8被RFC 3629重新规范，只能使用原来Unicode定义的区域，U+0000到U+10FFFF，也就是说最多四个字节）</p></blockquote> <table><thead><tr><th>Unicode 码点范围</th> <th>字节数</th> <th>UTF-8 编码</th></tr></thead> <tbody><tr><td>U+0000 - U+007F</td> <td>1</td> <td><code>0xxxxxxx</code></td></tr> <tr><td>U+0080 - U+07FF</td> <td>2</td> <td><code>110xxxxx 10xxxxxx</code></td></tr> <tr><td>U+10800 - U+FFFF</td> <td>3</td> <td><code>1110xxxx 10xxxxxx 10xxxxxx</code></td></tr> <tr><td>U+10000 - U+1FFFFF</td> <td>4</td> <td><code>11110xx 10xxxxxx 10xxxxxx 10xxxxxx</code></td></tr></tbody></table> <p><strong>举个🌰：</strong></p> <ol><li><code>🌰</code>在unicode中的码点为U+1F330，处于U+10000 - U+1FFFFF码点范围中，需要使用四个字节进行编码，其编码格式为：<code>11110xx 10xxxxxx 10xxxxxx 10xxxxxx</code></li> <li>0x1F330转二进制为：<code>11111001100110000</code>，从后向前补入<code>11110xx 10xxxxxx 10xxxxxx 10xxxxxx</code>，就得到了utf-8编码后的二进制数据啦：<code>11110000 10011111 10001100 10110000</code></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/10/2021, 10:00:29 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/xo-blog/assets/js/app.53de2eda.js" defer></script><script src="/xo-blog/assets/js/23.df71a9a8.js" defer></script><script src="/xo-blog/assets/js/22.21716c97.js" defer></script><script src="/xo-blog/assets/js/32.b0d4372d.js" defer></script>
  </body>
</html>
