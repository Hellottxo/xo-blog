import{_ as n,o as a,c as t,a as s}from"./app.c43dc0b4.js";var e="/xo-blog/assets/eventloop.7238f039.jpeg";const d='{"title":"Eventloop \u4E8B\u4EF6\u5FAA\u73AF","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u4EC0\u4E48\u662F Eventloop","slug":"\u4EC0\u4E48\u662F-eventloop"},{"level":2,"title":"\u5B8F\u4EFB\u52A1\u548C\u5FAE\u4EFB\u52A1","slug":"\u5B8F\u4EFB\u52A1\u548C\u5FAE\u4EFB\u52A1"}],"relativePath":"browser/eventloop.md","lastUpdated":1645672724000}',o={},p=s(`<h1 id="eventloop-\u4E8B\u4EF6\u5FAA\u73AF" tabindex="-1">Eventloop \u4E8B\u4EF6\u5FAA\u73AF <a class="header-anchor" href="#eventloop-\u4E8B\u4EF6\u5FAA\u73AF" aria-hidden="true">#</a></h1><p>\u4ECE\u9700\u6C42\u5F00\u59CB\uFF0C\u4E3A\u4EC0\u4E48\u8981\u4E86\u89E3 Eventloop\uFF1F\u5148\u4E3E\u4E2A\u7B80\u5355\u7684\u6817\u5B50 \u{1F330}\uFF1A</p><div class="language-javascript"><pre><code><span class="token keyword">const</span> <span class="token function-variable function">validate</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> timeStamp <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> timeStamp<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>\u4E0A\u8FF0\u7684\u4EE3\u7801\u7684\u8FD0\u884C\u7ED3\u679C\u662F\u4EC0\u4E48\u5462\uFF1F\u662F<code>500</code>\u5417\uFF1F</p><p>\u4E8B\u5B9E\u4E0A\uFF0C\u5F53\u6211\u4EEC\u5C1D\u8BD5\u591A\u6B21\u8FD0\u884C validate \u51FD\u6570\uFF0C\u4F1A\u53D1\u73B0\uFF0C<code>setTimeout</code>\u7684\u56DE\u8C03\u51FD\u6570\u6253\u5370\u51FA\u6765\u7684\u7ED3\u679C\u5E76\u4E0D\u662F\u6211\u4EEC\u60F3\u8C61\u4E2D\u7684 500\uFF0C\u751A\u81F3\u4E0D\u662F\u4E00\u4E2A\u56FA\u5B9A\u7684\u6570\u503C\u3002</p><div class="language-"><pre><code>validate(); // 501
validate(); // 503
validate(); // 502
</code></pre></div><p>\u4E3A\u4EC0\u4E48\u5B9A\u65F6\u5668\u4E0D\u5982\u6211\u4EEC\u60F3\u8C61\u4E2D\u7684\u65B9\u5F0F\u8FD0\u4F5C\u5462\uFF1F</p><p>\u8BA9\u6211\u4EEC\u5E26\u7740\u7591\u95EE\uFF0C\u6765\u5B66\u4E60 Eventloop \u5427\u3002</p><p>\u901A\u8FC7\u5B66\u4E60 Eventloop\uFF0C\u6DF1\u5165\u4E86\u89E3 Js \u5728\u6D4F\u89C8\u5668\u4E2D\u7684\u8FD0\u884C\u673A\u5236\uFF0C\u4EE5\u65B9\u4FBF\u6211\u4EEC\u5728\u5DE5\u4F5C\u548C\u5B66\u4E60\u4E2D\u66F4\u52A0\u8F7B\u677E\u7684\u89E3\u51B3\u5404\u79CD\u95EE\u9898\u3002</p><h2 id="\u4EC0\u4E48\u662F-eventloop" tabindex="-1">\u4EC0\u4E48\u662F Eventloop <a class="header-anchor" href="#\u4EC0\u4E48\u662F-eventloop" aria-hidden="true">#</a></h2><p>\u6211\u4EEC\u90FD\u77E5\u9053\uFF1A<strong>JS \u662F\u4E00\u95E8\u5355\u7EBF\u7A0B\u8BED\u8A00</strong>\u3002\u90A3\u4E48\u50CF<code>setTimeout</code>\u8FD9\u6837\u7684\u5F02\u6B65\u4EE3\u7801\u7A76\u7ADF\u662F\u5982\u4F55\u8FD0\u884C\u7684\u5462\uFF1F</p><p>\u9996\u5148\uFF0C\u6211\u4EEC\u4ECE<a href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" target="_blank" rel="noopener noreferrer">HTML5 standard</a>\u4E2D\u4E86\u89E3\u5230\uFF1A\u4E00\u4E2A eventloop \u6709\u4E00\u4E2A\u6216\u591A\u4E2A\u4EFB\u52A1\u961F\u5217\uFF08Task queues\uFF09\uFF0C\u4E00\u4E2A Task queue \u5305\u542B\u4E00\u7EC4 task\u3002</p><p>\u503C\u5F97\u6CE8\u610F\u7684\u662F\uFF0C<a href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" target="_blank" rel="noopener noreferrer">HTML5 standard</a>\u7279\u610F\u63D0\u9192\u4E86\u6211\u4EEC\uFF1A</p><blockquote><p><a href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" target="_blank" rel="noopener noreferrer">Task queues</a> <em>are</em> <a href="https://infra.spec.whatwg.org/#ordered-set" target="_blank" rel="noopener noreferrer">sets</a><em>, not</em> <a href="https://infra.spec.whatwg.org/#queue" target="_blank" rel="noopener noreferrer">queues</a><em>, because</em> <a href="https://html.spec.whatwg.org/multipage/webappapis.html#step1" target="_blank" rel="noopener noreferrer">step one of the event loop processing model</a> <em>grabs the first</em> <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-runnable" target="_blank" rel="noopener noreferrer"><em>runnable</em></a> <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" target="_blank" rel="noopener noreferrer">task</a> <em>from the chosen queue, instead of</em> <a href="https://infra.spec.whatwg.org/#queue-dequeue" target="_blank" rel="noopener noreferrer">dequeuing</a> <em>the first task.</em></p></blockquote><p>\u6765\u770B\u4E00\u5F20\u7ECF\u5178\u7684 eventloop \u8FD0\u884C\u56FE\u3002</p><p><img src="`+e+`" alt=""></p><p>\u5982\u56FE\u6240\u793A\uFF0Ctask \u6267\u884C\u65F6\u4F1A\u4F1A\u5C06\u4EE3\u7801 push \u8FDB\u8C03\u7528\u6808\uFF08Call Stack\uFF09\uFF0C\u6267\u884C\u5B8C\u6BD5\u540E\uFF0C\u4EE5\u540E\u8FDB\u5148\u51FA\u7684\u539F\u5219\u4ECE\u8C03\u7528\u6808\u4E2D\u79FB\u9664\u3002\u8C03\u7528\u6808\u4E2D\u9047\u5230\u5F02\u6B65 API \u65F6\uFF0C\u6EE1\u8DB3\u6761\u4EF6\u540E\u5C06\u5F02\u6B65 API \u7684\u56DE\u8C03\u51FD\u6570\u653E\u5165\u4E8B\u4EF6\u961F\u5217\uFF08Event Queue\uFF09\u4E2D\uFF0C \u7B49\u5F85\u5F53\u524D\u8C03\u7528\u6808\u6E05\u7A7A\u540E\uFF0C\u4EE5\u5148\u8FDB\u5148\u51FA\u7684\u539F\u5219\uFF0C\u6267\u884C\u4E8B\u4EF6\u961F\u5217\u4E2D\u7684\u56DE\u8C03\u51FD\u6570\uFF0C\u5982\u6B64\u5FAA\u73AF\u5F80\u590D\uFF0C\u5C31\u662F<strong>Eventloop</strong>\u3002</p><p>\u5230\u8FD9\u91CC\uFF0C\u6211\u4EEC\u56DE\u5230\u7B2C\u4E00\u4E2A\u95EE\u9898\uFF0C<strong>\u4E3A\u4EC0\u4E48 setTimeout \u5B9A\u65F6\u5668\u4E0D\u5982\u6211\u4EEC\u60F3\u8C61\u4E2D\u51C6\u786E\u5462\uFF1F</strong></p><p>\u7B54\u6848\u5DF2\u7ECF\u547C\u4E4B\u6B32\u51FA\u4E86\uFF1A\u5B9A\u65F6\u5668\u8BBE\u7F6E\u7684\u65F6\u95F4\u8FC7\u540E\uFF0C<code>setTimeout</code>\u7684\u56DE\u8C03\u51FD\u6570\u653E\u5165\u4E8B\u4EF6\u961F\u5217\u540E\uFF0C\u7B49\u5F85\u8C03\u7528\u6808\u6267\u884C\u7684\u8FD9\u6BB5\u65F6\u95F4\uFF0C\u9020\u6210\u4E86\u5B9A\u65F6\u5668\u6267\u884C\u7684\u8BEF\u5DEE\u3002</p><p>\u8BA9\u6211\u4EEC\u66F4\u52A0\u6DF1\u5165\u4E00\u70B9\uFF0C\u5F53 Promise \u9047\u4E0A</p><p>\u501F\u7528\u4E00\u4E0B Jake Archibald \u7684\u4F8B\u5B50\u3002</p><div class="language-javascript"><pre><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;script start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;setTimeout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;promise1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;promise2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;script end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>\u4E0A\u9762\u8FD9\u6BB5\u4EE3\u7801\u7684\u8F93\u51FA\u7ED3\u679C\u4F1A\u662F\u600E\u6837\u7684\u5462\uFF1F</p><div class="language-javascript"><pre><code>script start
script end
promise1
promise2
setTimeout
</code></pre></div><p>\u54A6\uFF0C\u548C\u60F3\u8C61\u4E2D\u7684\u7ED3\u679C\u4E0D\u592A\u4E00\u6837\u5BF9\u4E0D\u5BF9\uFF1F</p><p>\u6309\u7167\u524D\u6587\u7684\u63CF\u8FF0\uFF0C\u6211\u4EEC\u7406\u60F3\u7684\u7ED3\u679C\u5E94\u5F53\u662F:</p><div class="language-js"><pre><code>script start
script end
setTimeout
promise1
promise2
</code></pre></div><p>\u4E3A\u4EC0\u4E48\u5462\uFF1F</p><h2 id="\u5B8F\u4EFB\u52A1\u548C\u5FAE\u4EFB\u52A1" tabindex="-1">\u5B8F\u4EFB\u52A1\u548C\u5FAE\u4EFB\u52A1 <a class="header-anchor" href="#\u5B8F\u4EFB\u52A1\u548C\u5FAE\u4EFB\u52A1" aria-hidden="true">#</a></h2><p>\u4E0D\u6025\uFF0C\u8BA9\u6211\u4EEC\u5148\u770B\u770B<a href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" target="_blank" rel="noopener noreferrer">HTML5 standard</a>\u4E2D\u5BF9<strong>eventloop</strong>\u7684\u8FD9\u6837\u4E00\u6BB5\u63CF\u8FF0\uFF1A</p><blockquote><p>Each <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" target="_blank" rel="noopener noreferrer">event loop</a> has a currently running task, which is either a <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" target="_blank" rel="noopener noreferrer">task</a> or null. Initially, this is null. It is used to handle reentrancy.</p><p>Each <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" target="_blank" rel="noopener noreferrer">event loop</a> has a microtask queue, which is a <a href="https://infra.spec.whatwg.org/#queue" target="_blank" rel="noopener noreferrer">queue</a> of <a href="https://html.spec.whatwg.org/multipage/webappapis.html#microtask" target="_blank" rel="noopener noreferrer">microtasks</a>, initially empty. A microtask is a colloquial way of referring to a <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" target="_blank" rel="noopener noreferrer">task</a> that was created via the <a href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-microtask" target="_blank" rel="noopener noreferrer">queue a microtask</a> algorithm.</p><p>Each <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" target="_blank" rel="noopener noreferrer">event loop</a> has a performing a microtask checkpoint boolean, which is initially false. It is used to prevent reentrant invocation of the <a href="https://html.spec.whatwg.org/multipage/webappapis.html#perform-a-microtask-checkpoint" target="_blank" rel="noopener noreferrer">perform a microtask checkpoint</a> algorithm.</p></blockquote><p>\u901A\u5E38\uFF0C\u6211\u4EEC\u4F1A\u5C06\u5F02\u6B65 API \u5206\u4E3A<strong>\u5B8F\u4EFB\u52A1\uFF08macrotask\uFF09<strong>\u548C</strong>\u5FAE\u4EFB\u52A1\uFF08microtask\uFF09</strong>\uFF0C\u4E5F\u5C31\u662F\u4E0A\u8FF0\u6807\u51C6\u4E2D\u7684 task \u548C microtask\u3002<strong>\u5FAE\u4EFB\u52A1\u4F1A\u5148\u4E8E\u5B8F\u4EFB\u52A1\u6267\u884C\uFF0C\u5B8F\u4EFB\u52A1\u4F1A\u89E6\u53D1\u4E00\u6B21\u5B8C\u6574\u7684\u4E8B\u4EF6\u5FAA\u73AF\uFF0C\u800C\u5FAE\u4EFB\u52A1\u4E0D\u4F1A\u3002</strong></p><p><strong>\u5E38\u89C1\u7684\u6D4F\u89C8\u5668\u5FAE\u4EFB\u52A1/\u5B8F\u4EFB\u52A1</strong></p><blockquote><p><strong>\u5B8F\u4EFB\u52A1\uFF08macrotask\uFF09</strong>\uFF1AsetTimeout\u3001setInterval\u3001I/O\u3001UI \u4EA4\u4E92\u4E8B\u4EF6\u7B49\u3002</p><p><strong>\u5FAE\u4EFB\u52A1\uFF08microtask\uFF09</strong>\uFF1APromise.then\u3001 MutationObserver \u7B49\u3002</p></blockquote><p>\u57FA\u4E8E\u5B8F\u4EFB\u52A1\u548C\u5FAE\u4EFB\u52A1\uFF0C\u8BA9\u6211\u4EEC\u518D\u5B8C\u5584\u4E00\u4E0B\u5BF9\u4E8E<strong>Eventloop</strong>\u7684\u63CF\u8FF0\uFF1A</p><ol><li>task \u6267\u884C\u65F6\u4F1A\u4F1A\u5C06\u4EE3\u7801 push \u8FDB\u8C03\u7528\u6808\uFF08Call Stack\uFF09\uFF0C\u6267\u884C\u5B8C\u6BD5\u540E\uFF0C\u4EE5\u540E\u8FDB\u5148\u51FA\u7684\u539F\u5219\u4ECE\u8C03\u7528\u6808\u4E2D\u79FB\u9664\uFF1B</li><li>\u8C03\u7528\u6808\u4E2D\u9047\u5230\u5F02\u6B65 API \u65F6\uFF0C\u6EE1\u8DB3\u6761\u4EF6\u540E\uFF0C\u5FAE\u4EFB\u52A1\u53CA\u5B8F\u4EFB\u52A1\u7684\u56DE\u8C03\u51FD\u6570\u5206\u522B\u8FDB\u5165\u76F8\u5E94\u7684\u4E8B\u4EF6\u961F\u5217\uFF1B</li><li>\u7B49\u5F85\u5F53\u524D\u8C03\u7528\u6808\u6E05\u7A7A\u540E\uFF0C\u4F9D\u6B21\u6267\u884C\u5FAE\u4EFB\u52A1\u4E8B\u4EF6\u961F\u5217\u4E2D\u7684\u56DE\u8C03\u51FD\u6570\uFF1B</li><li>\u5F53\u5FAE\u4EFB\u52A1\u4E8B\u4EF6\u961F\u5217\u53CA\u5F53\u524D\u8C03\u7528\u6808\u6E05\u7A7A\u540E\uFF0C\u5F00\u59CB\u6267\u884C\u5B8F\u4EFB\u52A1\u4E8B\u4EF6\u961F\u5217\u4E2D\u7684\u56DE\u8C03\u51FD\u6570\u3002\u5982\u6B64\u5FAA\u73AF\u5F80\u590D\uFF0C\u5C31\u662F<strong>Eventloop</strong>\u3002</li></ol><p>\u8FD9\u65F6\uFF0C\u56DE\u5230\u4E0A\u6587\u4E2D<code>promise</code>\u548C<code>setTimeout</code>\u7684\u4F8B\u5B50\uFF0C\u6211\u4EEC\u6765\u9010\u884C\u89E3\u6790\u4E00\u4E0B\uFF1A</p><ol><li>\u5F53\u524D task \u6267\u884C\uFF0C\u8F93\u51FA<code>script start</code></li><li>setTimeout \u7684 callback \u88AB\u6DFB\u52A0\u8FDB macrotask \u961F\u5217\u4E2D</li><li>\u5B9E\u4F8B\u5316<code>Promise</code>\uFF0C<code>Promise.then</code>\u7684 callback \u88AB\u4F9D\u6B21\u6DFB\u52A0\u8FDB microtask \u961F\u5217\u4E2D</li><li>\u8F93\u51FA<code>script end</code></li><li>\u5F53\u524D task \u6267\u884C\u5B8C\u6BD5\uFF0Ccall stack \u4E3A\u7A7A\uFF0C\u4F9D\u6B21\u6267\u884C microtask \u961F\u5217\u4E2D\u7684 callback\uFF0C\u4F9D\u6B21\u8F93\u51FA 1\uFF0C2</li><li>\u6267\u884C\u4E0B\u4E00\u4E2A task\uFF0C\u8F93\u51FA<code>setTimeout</code></li></ol>`,38),r=[p];function c(l,i,u,k,h,g){return a(),t("div",null,r)}var f=n(o,[["render",c]]);export{d as __pageData,f as default};
