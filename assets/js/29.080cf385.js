(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{359:function(t,s,a){t.exports=a.p+"assets/img/numInJs.289f2b6a.jpg"},360:function(t,s,a){t.exports=a.p+"assets/img/numInJsfunc.0afbaa15.png"},426:function(t,s,a){"use strict";a.r(s);var e=a(33),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"小数精度丢失的原因"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#小数精度丢失的原因"}},[t._v("#")]),t._v(" 小数精度丢失的原因")]),t._v(" "),e("p",[t._v("计算机由晶体管组成，所以内部数据的存储和运算都采用二进制，而我们在实际生活工作中，使用的是十进制。"),e("br"),t._v("\n因此，对于计算机在运算时产生的精度问题，本质上是使用二进制模拟十进制进行运算产生的精度问题。")]),t._v(" "),e("h2",{attrs:{id:"js中的数字储存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#js中的数字储存"}},[t._v("#")]),t._v(" Js中的数字储存")]),t._v(" "),e("blockquote",[e("p",[t._v("根据 ECMAScript 标准，JavaScript 中只有一种数字类型：基于 IEEE 754 标准的双精度 64 位二进制格式的值。")])]),t._v(" "),e("p",[e("img",{attrs:{src:a(359),alt:"numInJs"}}),t._v("\n如图所示，64位可分为三部分：")]),t._v(" "),e("ol",[e("li",[t._v("符号为S：0代表正数，1代表负数")]),t._v(" "),e("li",[t._v("阶码位E：在机器中表示一个浮点数时需要给出指数，这个指数用整数形式表示，这个整数叫做阶码，阶码指明了小数点在数据中的位置。")]),t._v(" "),e("li",[t._v("小数位M：超出部分自动进1舍0")])]),t._v(" "),e("p",[t._v("IEEE 754 标准规定的二进制表现为：\n"),e("img",{attrs:{src:a(360),alt:"numInJs"}})]),t._v(" "),e("p",[t._v("为什么"),e("code",[t._v("E-1023")]),t._v("，"),e("code",[t._v("M+1")]),t._v("呢？")]),t._v(" "),e("p",[t._v("计算机中实际储存数字时，遵循科学计数法（如上图所示），且整数位为1。")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("E-1023")]),e("br"),t._v("\n科学计数法中的指数位是允许为负的，计算机底层只可以进行加法运算，因此引入偏移量表示负数，约定阶码减去1023，[0,1022]表示为负，[1024,2047]表示为正。")]),t._v(" "),e("li",[e("code",[t._v("M+1")]),e("br"),t._v("\n整数位固定为1，所以储存时舍去。M的固定长度加上被省略的整数位为53，因此有"),e("code",[t._v("Number.MAX_SAFE_INTEGER === Math.pow(2, 53) - 1")]),t._v(",而非"),e("code",[t._v("Number.MAX_SAFE_INTEGER === Math.pow(2, 52) - 1")]),t._v("。")])]),t._v(" "),e("h2",{attrs:{id:"_0-1-0-2-0-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_0-1-0-2-0-3"}},[t._v("#")]),t._v(" 0.1 + 0.2 !== 0.3")]),t._v(" "),e("p",[t._v("小数位超出52时会自动进1舍0，加上隐含的整数位，Js中小数位的长度为：")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("Math"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("pow")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("53")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 16")]),t._v("\n")])])]),e("p",[t._v("0.1转换为二进制为："),e("code",[t._v("0.00011...0011")]),t._v("，0.2转换为二进制为"),e("code",[t._v("0.0011...0011")]),t._v("，0.1 + 0.2为"),e("code",[t._v("0.010011...0011")]),t._v("，使用整数为1，科学计数法的形式(不考虑偏移量表现形式)表示为"),e("code",[t._v("1.00110011...0011x2^-2")]),t._v("，此时"),e("code",[t._v("00110011...0011")]),t._v("第53位为"),e("code",[t._v("1")]),t._v("，进1舍0，小数部位的值位"),e("code",[t._v("00110011...0011010")]),t._v("，转换为十进制后为"),e("code",[t._v("0.30000000000000004")]),t._v("，因此"),e("code",[t._v("0.1 + 0.2 !== 0.3")]),t._v("。")]),t._v(" "),e("h2",{attrs:{id:"number-prototype-tofixed"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#number-prototype-tofixed"}},[t._v("#")]),t._v(" Number.prototype.toFixed()")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Number/toFixed",target:"_blank",rel:"noopener noreferrer"}},[t._v("MDN"),e("OutboundLink")],1),t._v("中对"),e("code",[t._v("toFixed()")]),t._v("的描述：")]),t._v(" "),e("blockquote",[e("p",[t._v("一个数值的字符串表现形式，不使用指数记数法，而是在小数点后有 digits（注：digits具体值取决于传入参数）位数字。该数值在必要时进行四舍五入，另外在必要时会用 0 来填充小数部分，以便小数部分有指定的位数。 如果数值大于 1e+21，该方法会简单调用 Number.prototype.toString()并返回一个指数记数法格式的字符串。"),e("br"),t._v("\n描述中提到：\n该数值在必要时进行四舍五入"),e("br"),t._v("\n我们来测试一下：")])]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" num "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.152348")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nnum"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("toFixed")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// '0.2'")]),t._v("\nnum"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("toFixed")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// '0.1523'")]),t._v("\n")])])]),e("p",[e("strong",[t._v("为什么"),e("code",[t._v("num.toFixed(4)")]),t._v("的值为"),e("code",[t._v("0.1523")]),t._v("，而不是"),e("code",[t._v("0.1524")]),t._v("呢？")]),t._v("\n我们来看一下"),e("a",{attrs:{href:"https://github.com/v8/v8/blob/4b9b23521e6fd42373ebbcb20ebe03bf445494f9/src/fixed-dtoa.cc#L242",target:"_blank",rel:"noopener noreferrer"}},[t._v("v8源码"),e("OutboundLink")],1),t._v("中关键的一段：")]),t._v(" "),e("div",{staticClass:"language-c++ extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("// If the first bit after the point is set we have to round up.\nif (point > 0 && ((fractionals >> (point - 1)) & 1) == 1) {\n  DtoaRoundUp(buffer, length, decimal_point);\n}\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);