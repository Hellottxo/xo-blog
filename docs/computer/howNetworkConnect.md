# 精读《网络是怎样连接的》

### 生成 HTTP 请求

输入网址后，浏览器的第一步工作就是对 URL 进行解析，生成发送给 Web 服务器的消息。**URL 的格式会随着协议的不同而不同，访问 web 服务器时应该使用 HTTP 协议**。

```
URL = HTTP协议 + // + Web服务器名 + 数据源路径名
```

HTTP 协议定义了客户端和服务器之间交互的消息内容和步骤。

首先，客户端会向服务器发送请求消息，服务器接收到消息后，根据消息中的 URI 和 HTTP 方法进行工作并响应。

```
URI(Uniform Resource Identifier) 统一资源标识符
URL(Uniform Resource Locator) 统一资源定位符
URL是URI的子集。URL是URI的一种形式。
```

### DNS 查询

根据域名查询 IP 地址时，浏览器会使用 DNS 解析器，DNS 查询时，使用的是 UDP 协议。

DNS 解析器实际上是一段程序，包含在操作系统的 Socket 库中，Socket 库是用于调用网络功能的程序组件集合。

### 委托协议栈发送消息

浏览器委托协议栈使用 TCP 协议来收发数据，需要按照指定的顺序来调用 socket 库中的程序组件。

协议栈收到委托之后收发数据的过程：

1. 创建套接字

   调用 socket 创建套接字，会在内存中开辟一个套接字所需的空间，然后向其中写入初始状态。

   套接字只是一个概念，可以理解为存放了控制信息的内存空间，协议栈时根据这些信息进行工作。windows 中可以使用 netstat 命令显示套接字内容。

2. 将管道连接到服务器端的套接字上

   调用 socket 库中的 connect 组件完成客户端套接字与服务端套接字连接，调用 connect 时，需要指定描述符、服务器 IP、端口号。**描述符用于计算机内部识别套接字机制，端口号和 IP 是客户端和服务端之间用来识别套接字的机制。**

3. 收发数据

4. 断开管道并删除套接字
